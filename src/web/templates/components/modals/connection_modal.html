<!-- Модальное окно подключения -->
<div id="conn_modal" class="modal-overlay" onclick="closeConnModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h2 id="conn_form_title" class="flex" style="margin:0">
                <i data-lucide="plus-circle" style="color: var(--accent-primary)"></i>
                Добавить подключение
            </h2>
            <button class="btn-transparent" onclick="closeConnModal()" style="padding:0.5rem">
                <i data-lucide="x" style="width:24px; height:24px"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <input type="text" id="conn_name" placeholder="Название (например, OpenAI)">
                <input type="hidden" id="conn_provider">
                <div class="custom-dropdown" data-input-id="conn_provider">
                    <div class="dropdown-trigger">
                        <span class="selected-text">Выберите провайдера...</span>
                        <i data-lucide="chevron-down" class="dropdown-arrow"
                            style="width: 16px; height: 16px; color: var(--text-secondary);"></i>
                    </div>
                    <div class="dropdown-menu">
                        {% for key, val in providers.items() %}
                        <div class="dropdown-option" data-value="{{ key }}" data-url="{{ val.url }}">
                            {{ val.name }}
                        </div>
                        {% endfor %}
                        <div class="dropdown-option" data-value="custom">Другой (Custom)</div>
                    </div>
                </div>
                <input type="text" id="conn_model" placeholder="Модель (gpt-4o, anthropic/claude-3)">
                <input type="password" id="conn_key" placeholder="API Key">
                <input type="text" id="conn_url" placeholder="Base URL (optional)">
                <div class="form-actions"
                    style="margin-top: 1.5rem; display: flex; gap: 1rem; width: 100%; justify-content: flex-end;">
                    <button id="conn_check_btn" onclick="checkCurrentConn()" class="btn"
                        style="background:transparent; border:1px solid var(--accent-primary); color: var(--accent-primary);">
                        <i data-lucide="activity" style="width: 16px; height: 16px;"></i>
                        Проверить
                    </button>
                    <div style="flex-grow: 1;"></div>
                    <button id="conn_cancel_btn" onclick="closeConnModal()" class="btn"
                        style="background:transparent; border:1px solid var(--border-color);">
                        <i data-lucide="x-circle" style="width: 16px; height: 16px;"></i>
                        Отмена
                    </button>
                    <button id="conn_submit_btn" onclick="addConn()" class="btn btn-primary">
                        <i data-lucide="save" style="width: 16px; height: 16px;"></i>
                        Добавить
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>