<!-- Активные чаты -->
<div class="card">
    <h2 class="flex">
        <i data-lucide="users" class="text-accent icon-medium"></i>
        Активные чаты
    </h2>
    <table class="chats-table">
        <thead>
            <tr>
                <th>Платформа</th>
                <th>Тип</th>
                <th>ID Чата</th>
                <th>Название</th>
                <th>Сообщений</th>
                <th>Whitelist</th>
                <th>Последняя активность</th>
                <th class="text-right">Управление</th>
            </tr>
        </thead>
        <tbody id="active_chats_body">
            {% for c in chats|sort(attribute='last_message_at', reverse=True) %}
            <tr>
                <td>
                    {% if c.platform == 'telegram' %}
                    <div class="flex text-telegram" title="Telegram">
                        <i data-lucide="send" class="icon-xs"></i>
                    </div>
                    {% elif c.platform == 'discord' %}
                    <div class="flex text-discord" title="Discord">
                        <i data-lucide="gamepad-2" class="icon-xs"></i>
                    </div>
                    {% else %}
                    {{ c.platform }}
                    {% endif %}
                </td>
                <td>
                    {% if c.chat_type == 'private' %}
                    <i data-lucide="user" title="Личное сообщение" class="icon-xs opacity-70"></i>
                    {% else %}
                    <i data-lucide="users" title="Группа/Сервер" class="icon-xs opacity-70"></i>
                    {% endif %}
                </td>
                <td class="font-mono text-xs opacity-80">{{ c.chat_id }}</td>
                <td class="font-medium">{{ c.title }}</td>
                <td>
                    <span class="badge badge-primary font-semibold">
                        {{ c.message_count }}
                    </span>
                </td>
                <td>
                    {% if c.is_allowed %}
                    <span class="flex text-success text-xs font-medium">
                        <i data-lucide="check-circle" class="icon-micro mr-2"></i>
                        В списке
                    </span>
                    {% else %}
                    <span class="flex text-secondary text-xs opacity-60">
                        <i data-lucide="minus-circle" class="icon-micro mr-2"></i>
                        Нет
                    </span>
                    {% endif %}
                </td>
                <td class="text-xs text-secondary">
                    {{ c.last_message_at.strftime('%H:%M %d.%m') if c.last_message_at else '-' }}
                </td>
                <td>
                    <div class="flex justify-end">
                        <button class="btn btn-danger btn-table"
                            onclick="clearChat('{{ c.chat_id }}', '{{ c.platform }}')">
                            <i data-lucide="trash-2" class="icon-small mr-2"></i>
                            Очистить
                        </button>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" class="text-center p-8 text-secondary">Нет активных
                    диалогов</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>