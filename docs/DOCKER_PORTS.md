# Конфигурация портов Docker

## Описание

Все порты в Docker Compose теперь настраиваются через переменные окружения в файле `.env`.

## Переменные портов в .env

```bash
# Docker ports
APP_PORT=8000      # Внутренний порт приложения
DB_PORT=5432       # Внешний порт PostgreSQL (для подключения с хоста)
NGINX_PORT=80      # Внешний порт Nginx (доступен на хосте)
```

## Как это работает

### 1. Сервис `app`

- Приложение слушает на порту `${APP_PORT}` внутри контейнера
- Порт НЕ пробрасывается наружу (доступен только через nginx)

### 2. Сервис `db`

- PostgreSQL слушает на порту 5432 внутри контейнера
- Порт пробрасывается на хост как `${DB_PORT}:5432`
- Можно подключиться с хоста: `localhost:${DB_PORT}`

### 3. Сервис `nginx`

- Nginx слушает на порту 80 внутри контейнера
- Порт пробрасывается на хост как `${NGINX_PORT}:80`
- Nginx проксирует запросы на `app:${APP_PORT}`
- Конфигурация генерируется из шаблона `nginx/default.conf.template`

## Volumes

Оставлен только один volume для сохранения данных PostgreSQL:

- `postgres_data:/var/lib/postgresql/data`

## Пример использования

### Стандартные порты (по умолчанию)

```bash
APP_PORT=8000
DB_PORT=5432
NGINX_PORT=80
```

Доступ:

- Веб-интерфейс: `http://localhost:80`
- База данных: `localhost:5432`

### Кастомные порты

```bash
APP_PORT=8000
DB_PORT=5433
NGINX_PORT=8080
```

Доступ:

- Веб-интерфейс: `http://localhost:8080`
- База данных: `localhost:5433`

## Важно

- Образ `nginx:alpine` автоматически обрабатывает файлы `.template` из `/etc/nginx/templates/`
- При запуске контейнера nginx подставляет переменные окружения и создает финальную конфигурацию
- Не нужно вручную генерировать конфигурацию nginx
